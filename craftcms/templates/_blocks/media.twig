{## Media Block Base
 ------------------------------------------------------------------------------------ ##
    New block variations should extend this template rather than `_blocks/_common`.

    i.e. {% extends "_blocks/media" %}
 ------------------------------------------------------------------------------------ ##}
{% extends "_blocks/_common" %}


{## Micro-layouts are defined and documented within `_layouts/base/micro`

    View: http://localhost/sitebook/layouts/micro-layouts
    Docs: http://buildwithburton.com/docs/micro-layouts

 ------------------------------------------------------------------------------------ ##}
{% import "_layouts/base/micro" as micro %}

{% block content %}

    {{ micro.layout(
        [
            block('content_text'), block('content_media'),
            block('block_header'), block('block_footer')
        ],
        block.settings.microLayout ??? null,
        block.settings.container    ?? null
    ) }}

{% endblock content %}


{% block content_media %}

    {% set sourceItems = 'local' == block.source ??? null
        ? block.assets.all() ??? null : block.embeds.all() ??? null %}

    {% set itemsLoop = [] %}
    {% for item in sourceItems %}
        {% set itemsLoop = itemsLoop|merge([{
            headline : item.headline  ??? null,
            summary  : item.summary   ??? null,
            image    : item.images    ??? null,
            sourceUrl: item.sourceUrl ??? null,
            url      : item.url       ??? null,
            entry    : item           ??? null,
            section  : 'media'        ??? null,
        }]) %}
    {% endfor %}

    {% set cardLoop   = cardLoop   ??? block.settings.cardLoop   ??? null %}
    {% set cardGrid   = cardGrid   ??? block.settings.cardGrid   ??? 'stacked2' %}
    {% set cardLayout = cardLayout ??? block.settings.cardLayout ??? 'standard' %}

    {% if 'interactive' == block.settings.variant ??? null %}
        {% set cardLoop   = '_components/accordion/simple' %}
        {% set cardLayout = ['detail.accordion', 'detail'] %}
    {% endif %}

    {{ cardLoop
        ? block( 'media_render_layout' )
        : block( 'media_render_grid' ) }}
{% endblock %}


{## Render within a simple grid
 ------------------------------------------------------------------------------------ ##}
{% block media_render_grid %}

    {% import "_layouts/base/grids" as grids %}
    {% import "_components/cards" as cards %}
    {{ grids.generate(
        cards.deck( itemsLoop, cardLayout, block.settings ??? null ),
        cardGrid
    ) }}
{% endblock %}



{## Render in a specific layout component (accordion, carousel, etc)
 ------------------------------------------------------------------------------------ ##}
{% block media_render_layout %}

    {{ include( cardLoop ??? null, {
        items: itemsLoop ??? null,
        card : cardLayout  ??? null
    }, withContext = false  ) }}

{% endblock %}
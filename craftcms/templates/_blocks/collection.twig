{## Collection Block
    ---------------------------------------------------------------------------- ##
    this template is typically included from `_blocks/_base.twig` which pre-sets
    a handful of variables and passes them into this template via twig context.
 ## ---------------------------------------------------------------------------- ##}
{% set thisBlock = {
    content     : null,
    settings    : null,
    blockLayout : '_layouts/micro/blockLayoutTopBottom',
}|map( (item,key) => _context[key] ??? settings[key] ??? item ) %}

{% embed thisBlock.blockLayout %}
    {## primary text content is already added to this block layout via the `cell1Body`
        variable declared in `_blocks/_base`. Uncomment {% block %} below to customize

        {% block cell1Body %}
          {{ thisBlock.content.text }}
        {% endblock %}
    ##}

    {% block cell2Body %}

        {% set itemSource = thisBlock.content.collectionType ??? null %}

        {% if itemSource == 'search' %}

            {## are we using (one or more) Content Search entries to choose our items? ##}
            {{ sprig( "_components/search/contentSearch.sprig", {
                settings  : thisBlock.settings,
                limit     : thisBlock.content.limit ??? null,
                pagination: thisBlock.content.pagination.value ??? null,
                searchID  : thisBlock.content.searches.ids() ??? null,
            }) }}

        {% else %}

            {## or did we chose specific entries/assets or custom items? ##}
            {% set collectionItems = [] %}
            {% switch itemSource %}
                {% case "assets" %}
                    {% set collectionItems = thisBlock.content.assets.all()  ??? [] %}
                {% case "entries" %}
                    {% set collectionItems = thisBlock.content.entries.all() ??? [] %}
                {% default %}
                    {% set collectionItems = thisBlock.content.items.all()   ??? [] %}
            {% endswitch %}

            {## are we handing off the items to a custom component ##}
            {% set component = thisBlock.settings.itemComponent ??? null %}
            {% if component %}

                {{ include( component, {
                    items   : collectionItems,
                    settings: thisBlock.settings
                }, withContext = false ) }}

            {## or just using a standard grid+card layout ##}
            {% else %}

                {% set itemGrid = thisBlock.settings.itemGrid ??? '_layouts/micro/gridCols2' %}
                {% set itemCard = thisBlock.settings.itemCard ??? '_cards/item/basic' %}

                {% embed itemGrid %}
                    {% block items %}
                        {% for item in collectionItems %}
                            {{ include( itemCard, {
                                entry   : item,
                                loop    : loop,
                                settings: thisBlock.settings
                            }, withContext = false ) }}
                        {% endfor %}
                    {% endblock %}
                {% endembed %}

            {% endif %}

        {% endif %}

    {% endblock %}
{% endembed %}
{## Special Element Block Base
 ------------------------------------------------------------------------------------ ##
    -> http://localhost:8000/sitehub/blocks/special
 ------------------------------------------------------------------------------------ ##}
{% extends "_blocks/core/block" %}


{## Render the block using a two-zone micro-layout
 ------------------------------------------------------------------------------------ ##
    -> http://localhost:8000/sitehub/layout/micro-layouts
    -> http://buildwithburton.com/docs/micro-layouts
 ------------------------------------------------------------------------------------ ##}
{% block content %}

    {% from "_layout/core/micro" import layout as renderMicroLayout %}
    {# renderMicroLayout( layoutName, [ zone1, zone2, header, footer ], { arg1: x, .. } )
     -------------------------------------------------------------------------------- ##}
    {{ renderMicroLayout(
        block.settings.microLayout|default(),

        [ block('content_text'), block('content_special'),
          block('block_header'), block('block_footer') ],

        { container : block.settings.container|default() }
    ) }}

{% endblock content %}



{## Default handler for rendering special elements
 ------------------------------------------------------------------------------------ ##
    These blocks can be overridden in a child template
 ------------------------------------------------------------------------------------ ##}
{% block content_special %}{% apply spaceless %}

    {% set component = block.settings.specialComponent ??? null %}
    {% if component %}
        {% if '.sprig' in component %}
            {{ sprig( component, {
                content : processRichHtml( block.text ??? null ),
                settings: block.settings ??? {}
            }) }}
        {% else %}
            {{ include( component, {
                code: block.code ??? {}
            }, withContext = false ) }}
        {% endif %}
    {% else %}
        {% set blockName = 'special_' ~ block.variant %}
        {{ block( blockName ) is defined ? block( blockName ) }}
    {% endif %}

{% endapply %}{% endblock %}


{% block special_iframeCode %}
    {{ block.code|default()
        | retconAttr( 'iframe', { 'height' : false, 'width' : false } )
        | retconAttr( 'iframe', { 'class' : 'w-full aspect-video' } ) }}
{% endblock %}


{% block special_siteSearch %}
    {{ sprig( '_blocks/loop.searchResults.sprig', {
        settings  : block.settings | merge({
            cardGrid    : 'fixed1',
            cardLayout  : 'detail.search',
            requireQuery: true,
        }),
        limit    : 8,
        feedIds  : block.feeds.ids() ?? block.feeds ??? null,
        interface: 'fullSearch',
    }) }}
{% endblock %}


{% block special_navigation %}

{% endblock %}


{% block special_form %}

{% endblock %}

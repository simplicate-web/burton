{% extends template_from_string('{% block tabs %}{% endblock %}') %}

{% set settings  = settings ??? {} %}
{% set headertag = headertag ??? 'h3' %}

{% set items = items ??? [] %}
{% set count = items | length %}
{% set uuid  = create('craft\\helpers\\StringHelper').UUID() %}

{% block class__panel "p-6" %}

{% block class__panels "rounded-b-md border bg-theme-contrast" %}

{% block class__ul "!mb-0 flex flex-wrap sm:flex-row
    items-stretch
    justify-center
    sm:justify-start
" %}

{% block class__li "list-none !mb-0" %}

{% block class__buttonactive "bg-theme-accent text-canvas-light" %}

{% block class__button "
    inline-flex
    rounded
    sm:rounded-b-0
    border
    sm:border-b-0
    px-3
    py-2.5
    text-sm
    md:text-base
    lg:text-xs
    xl:text-base
" %}

{% block tabs -%}
{%- if count -%}

<div
    {## Set the first available tab on the page on page load. ##}
    x-data="{
        active: 1,
        init() {
            this.$nextTick( () => this.select(this.active) )
        },
        select(index) {
            this.active = index
        },
        isactive(index) {
            return (this.active == index)
        }
    }"
    x-cloak
    x-id="['tabs-{{uuid}}']"
>
    <!-- Tab List -->
    <ul
        x-ref="tabs-{{uuid}}"
        @keydown.right.prevent.stop="$focus.wrap().next()"
        @keydown.home.prevent.stop="$focus.first()"
        @keydown.page-up.prevent.stop="$focus.first()"
        @keydown.left.prevent.stop="$focus.wrap().prev()"
        @keydown.end.prevent.stop="$focus.last()"
        @keydown.page-down.prevent.stop="$focus.last()"
        role="tablist"
        class="{{ block( 'class__ul' ) }}"
    >
        <!-- Tab -->
        {% for item in items %}
            <li class="{{ block( 'class__li' ) }}">
                <button
                    id="tabs-{{uuid}}-{{loop.index}}"
                    @click="select({{loop.index}})"
                    @mousedown.prevent
                    @focus="select({{loop.index}})"
                    type="button"
                    :tabindex="isactive({{loop.index}}) ? 0 : -1"
                    :aria-selected="isactive({{loop.index}})"
                    :class="isactive({{loop.index}}) ? '{{ block('class__buttonactive' ) }}' : ''"
                    class="{{ block('class__button') }}"
                    role="tab"
                >{% block tab__title "" %}</button>
            </li>
        {% endfor %}
    </ul>

    <!-- Panels -->
    <div role="tabpanels" class="{{ block('class__panels') }}">
        {% for item in items %}
            <!-- Panel -->
            <section
                x-show="isactive({{loop.index}})"
                aria-labelledby="tabs-{{uuid}}-{{loop.index}}"
                role="tabpanel"
                class="{{ block('class__panel') }}"
            >
                {% block tab__content "" %}
            </section>
        {% endfor %}
    </div>
</div>
{%- endif %}{% endblock %}

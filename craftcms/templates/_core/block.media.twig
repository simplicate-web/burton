{## Media Block Base
 ------------------------------------------------------------------------------------ ##
    -> http://localhost:8000/sitehub/blocks/media
 ------------------------------------------------------------------------------------ ##}
{% extends [ "_site/block", "_core/block" ] %}
{% import "_core/assemble" as assemble %}

{% block content %}
    {% set microlayout = block.settings.microlayout|default('zone1Top') %}
    {{ assemble.microlayout( microlayout, {
        zone1    : block('block__text'),
        zone2    : block('block__media'),
        header   : block('block__header'),
        footer   : block('block__footer'),
    }, block.settings ) }}
{% endblock %}


{## Default handler for rendering media assets
 ------------------------------------------------------------------------------------ ##
    This block can be overridden in a child template
 ------------------------------------------------------------------------------------ ##}
{% block block__media %}

    {% set items  = [] %}
    {% set source = block.source|default('local') %}
    {% set limit  = block.source.limit ??? -1 %}

    {% if source == 'collect' %}
        {% set items = collectionContents( block.collections.ids(), { limit: limit } ) %}
    {% endif %}

    {% if source == 'local' %}
        {% for asset in block.assets.all() ??? block.assets ??? [] %}
            {% set items = items|merge([asset]) %}
        {% endfor %}
    {% endif %}

    {% if source == 'external' %}
        {% for item in block.external.all() ??? block.external ??? [] %}
            {% set embedInfo = item.sourceUrl|default() ? embedInfo( item.sourceUrl ) : null %}
            {% set items = items|merge([{
                entry    : item,
                embed    : embedInfo,
                source   : source,
                images   : item.images.all() ??? item.images ??? embedInfo.images ??? null,
                section  : 'media',
                summary  : item.summary   ??? embedInfo.summary ??? null,
                headline : item.headline  ??? embedInfo.title   ??? null,
                sourceUrl: item.sourceUrl ??? null,
            }]) %}
        {% endfor %}
    {% endif %}

    {% if source == 'code' %}
        {# {% set items = null %} #}
    {% endif %}


    {## Render the Media items by passing them to an iterator template.
     -------------------------------------------------------------------------------- ##}
    {% block block__media__iterator %}
        {% import "_core/assemble" as assemble %}
        {% set iterator = block.settings.iterator|default('default') %}
        {{- assemble.iterate( iterator, 'media', items, block.settings ) -}}
    {% endblock %}

{% endblock %}
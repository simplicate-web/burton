{## Media Block Base
 ------------------------------------------------------------------------------------ ##
    -> http://localhost:8000/sitehub/blocks/media
 ------------------------------------------------------------------------------------ ##}
{% set settings    = settings ??? block.settings ??? {}  %}
{% set microlayout = settings.microlayout ??? 'zone1Top' %}
{% set medialayer  = settings.medialayer  ??? 'default'  %}
{% set mediasource = block.source.value   ??? 'assets'   %}
{% set mediaitems  = [] %}

{% if mediasource == 'assets' %}
    {% set mediaitems = block.assets.all() ??? block.assets ??? [] %}
{% endif %}

{% if mediasource == 'external' %}
    {% for item in block.external.all() ??? block.external ??? [] %}
        {% set url = item.sourceUrl ??? item.url ??? null %}
        {% if url %}
            {% set oembed = MediaBase( url ) %}
            {% set mediaitems = mediaitems|merge([{
                _media   : item,
                url      : url,
                oembed   : oembed,
                images   : item.images.all() ??? item.images ??? oembed.images ??? null,
                summary  : item.summary   ??? oembed.summary ??? null,
                headline : item.headline  ??? oembed.title   ??? null,
            }]) %}
        {% endif %}
    {% endfor %}
{% endif %}

{% if mediasource == 'code' %}
    {% set mediaitems = block.images.all() ??? block.images ??? [] %}
{% endif %}

{% if mediasource == 'collect' %}
    {% set params = {
        limit: block.source.settings.limit ??? -1,
        field: 'assets'
    } %}

    {% set mediaitems = CollectionBase( block.collections.ids(), params ) %}
{% endif %}


{% embed [ "_site/block", "_core/block" ] with {
    block: block,
    settings: settings,
    medialayer: medialayer,
    mediaitems: mediaitems,
    microlayout: microlayout,
} %}
    {## Media Block Content ##}
    {% block content %}
        {% import "_core/assemble" as assemble %}
        {{ assemble.microlayout( microlayout, {
            zone1    : block('block__text'),
            zone2    : block('block__media'),
            header   : block('block__header'),
            footer   : block('block__footer'),
        }, settings ) }}
    {% endblock %}


    {## Zone 2 Content ##}
    {% block block__media %}
        {% import "_core/assemble" as assemble %}
        {{ assemble.media( mediaitems, medialayer, settings ) }}
    {% endblock %}
{% endembed %}
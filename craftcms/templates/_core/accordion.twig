{## Accordion Base Template
 ------------------------------------------------------------------------------------ ##

 ------------------------------------------------------------------------------------ ##}
{% extends template_from_string('{% block accordion %}{% endblock %}') %}


{% block panel__class       "mx-auto max-w-4xl space-y-4 w-full" %}
{% block panel__openclass   "shadow bg-canvas-light" %}
{% block panel__textclass   "p-6" %}
{% block panel__titleclass  "like-h4 !mb-0 text-left" %}
{% block panel__buttonclass "flex p-6 pb-0 w-full h-full items-center justify-between" %}

{% set uuid  = create('craft\\helpers\\StringHelper').UUID() %}
{% set headertag = headertag ??? 'h3' %}

{% set items = items ??? [] %}
{% set count = items | length %}

{% set firstopen   = firstopen ??? null %}
{% set firstactive = firstopen ? "#{uuid}-1" : '' %}

{% block accordion -%}
{%- if count -%}
    <div x-data="{ active: '{{firstactive}}' }" class="{{ block('panel__class') }}">
        {% for item in items %}
            {% block panel %}
                <div
                    role="region"
                    x-cloak
                    x-data="{
                        id: '{{uuid}}-{{loop.index}}',
                        animatingOpen: false,
                        get expanded() {
                            return this.active === this.id
                        },
                        set expanded(value) {
                            this.active = value ? this.id : null

                            if( this.active == this.id ) {
                                this.animatingOpen = true
                                setTimeout(() => {
                                    this.animatingOpen = false
                                }, 200 );
                            }
                        },
                        handleLeaving() {
                            if( this.animatingOpen ) {
                                setTimeout(() => {
                                    document.getElementById('{{uuid}}-{{loop.index}}-header').scrollIntoView({ behavior: 'smooth' })
                                }, 100 );
                            }
                        }
                    }"
                    :class="{ '{{ block( 'panel__openclass' ) }}': expanded }"
                >
                    <div class="h-full mb-0 scroll-mt-10" x-intersect:leave="handleLeaving()">
                        <button
                            x-on:click="expanded = !expanded"
                            :aria-expanded="expanded"
                            class="{{block('panel__buttonclass')}}"
                        >{% block panel__label %}
                            <{{headertag}}
                                id="{{uuid}}-{{loop.index}}-header"
                                class="{{ block('panel__titleclass') }}"
                            >{% block panel__title "" %}</{{headertag}}>

                            <span x-show="expanded"  aria-hidden="true" class="ml-4">
                                {{ svg('@webroot//static/svg/minus.svg') | attr({
                                    class: 'fill-current h-10 w-10'
                                }) }}
                            </span>

                            <span x-show="!expanded" aria-hidden="true" class="ml-4">
                                {{ svg('@webroot//static/svg/plus.svg') | attr({
                                    class: 'fill-current h-10 w-10'
                                }) }}
                            </span>
                        {% endblock %}</button>
                    </div>

                    <div x-show="expanded" x-collapse.duration.200ms>
                        <div class="{{ block( 'panel__textclass' ) }}">
                            {% block panel__content "" %}
                        </div>
                    </div>
                </div>
            {% endblock %}
        {% endfor %}
    </div>
{%- endif %}{% endblock %}

{## Image Block   [Core Template]
{---------------------------------------------------------------------------------------}
 -> http://localhost:8000/sitehub/blocks/image
{-------------------------------------------------------------------------------------##}
{% extends [ "_site/block", "_core/block" ] %}


{## Zone 2 Content / Variant Routing
{-------------------------------------------------------------------------------------##}
{% block block__zone2 %}
    {%- set settings = block.settings ??? null -%}
    {%- set settings = settings is not null and settings is iterable ? settings : {} -%}

    {%- set source = block.source.value ??? 'images'  -%}
    {%- set images = ( source == 'images' )
        ? block.images.all() ??? block.images ??? []
        : null -%}

    {# do we need to pull images from a collection? #}
    {%- if source == 'collect' and block.collections and block.collections is iterable -%}
        {%- set params = {
            limit: block.source.limit ??? -1,
            field: 'images'
        } -%}

        {%- set images = CollectionBase( block.collections, params ) -%}
    {%- endif -%}

    {## Let's us inherit from this template **at this point** in the render process,
        without requiring that we duplicate the above "collection" logic ##}
    {%- set blockname = 'image__' ~ settings.variant ??? 'default' -%}
    {{- block( blockname ) is defined ? block( blockname ) : block( 'image__default' ) -}}
{% endblock %}


{## Image Default
{-------------------------------------------------------------------------------------##}
{% block image__default %}
    {%- set settings = settings ?? block.settings ?? null -%}
    {%- set settings = settings is not null and settings is iterable ? settings : {} -%}
    {%- set settings = { imagelayer: 'default' } | merge( settings ) -%}
    {%- import "_assemble" as assemble -%}
    {{- assemble.images( settings.imagelayer, images, settings ) -}}
{% endblock %}

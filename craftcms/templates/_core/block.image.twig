{## Image Block   [Core Template]
{---------------------------------------------------------------------------------------}
  > http://localhost:8000/sitehub/blocks/image
{-------------------------------------------------------------------------------------##}
{% extends [ "_site/block", "_core/block" ] %}


{## Template Variables & Defaults
{-------------------------------------------------------------------------------------##}
{%- set block = block ?? {} -%}

{%- set settings = block.settings ?? null -%}
{%- set settings = settings is not null and settings is iterable ? settings : {} -%}
{%- set settings = {
    variant   : null,
    textlayer : 'default',
    source    : 'images',
    limit     : 24
} | merge( settings ) -%}


{## Zone 2 Content / Variant Routing
{-------------------------------------------------------------------------------------##}
{% block block__zone2 %}

    {## are we getting our assets from the block field? ##}
    {%- set images = ( settings.source == 'images' )
        ? block.images.all() ??? block.images ??? []
        : null -%}

    {## or do we need to pull them from a collection? ##}
    {%- if settings.source == 'collect' -%}

        {%- set collections = block.collections ??? [] -%}
        {%- set collections = collections is iterable ? collections : [] -%}

        {%- set images = CollectionResults( collections, {
            limit : settings.limit,
            static: 'images'
        } ) -%}
    {%- endif -%}


    {## Named Variant Block or Standard Layout
    {---------------------------------------------------------------------------------##}
    {%- set blockname = "image__#{settings.variant}" -%}
    {{- ( block( blockname ) is defined )
        ? block( blockname )
        : block( 'image__default' ) -}}
{% endblock %}


{## Image Default
{-------------------------------------------------------------------------------------##}
{% block image__default %}
    {%- set settings = settings ?? block.settings ?? null -%}
    {%- set settings = settings is not null and settings is iterable ? settings : {} -%}
    {%- set settings = { imagelayer: 'default' } | merge( settings ) -%}
    {%- import "_assemble" as assemble -%}
    {{- assemble.images( settings.imagelayer, images, settings ) -}}
{% endblock %}

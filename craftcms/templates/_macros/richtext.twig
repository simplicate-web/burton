{#
 # Richtext Macros
 #
 # For manipulating strings of html content generated by a richtext editor (i.e. Redactor)
 #
 # Usage:
 # {% import "_macros/richtext.twig" as richtext %}
 ##}


{% macro formatHeadline( headline, tag = null, class = null, template = null ) -%}{% apply spaceless %}
    {% if headline %}
        {% set eyebrow   = headline|retconOnly( 'div.eyebrow' ) ??? null %}
        {% set headline  = headline|retconRemove( 'div.eyebrow' ) ??? "" %}
        {% set plainText = headline|retconChange( ['h1','h2','h3','h4','h5','h6','p','li','div'], '' ) %}
        {## |widont ##}

        {% if tag %}
            {% set headline = "<#{tag}>#{plainText}</#{tag}>" %}
        {% endif %}

        {% set anchor = plainText|replace( {"\n": " " } )|striptags|kebab|ascii %}
        {% set headline =
            headline
            | retconAttr( ['h1','h2','h3','h4','h5','h6'], { 'id': anchor, 'class': class } )
            | retconWrap( "mark", "span.mark" )
            | retconChange( "mark", "span" )
            | retconChange( "span.mark", "mark" )
            | typogrify(true)
            | nl2br
        %}

        {% set headlineStyle  = headline|lower|replace( " ", "" ) %}
        {% set alignmentClass = "" %}
        {% if( 'text-align:left' in headlineStyle ) %}
            {% set alignmentClass = 'left' %}
        {% endif %}

        {% if( 'text-align:center' in headlineStyle ) %}
            {% set alignmentClass = 'center' %}
        {% endif %}

        {% if( 'text-align:right' in headlineStyle ) %}
            {% set alignmentClass = 'right' %}
        {% endif %}

        {% set alignmentClass = alignmentClass ? " cHeadline__#{alignmentClass}" : "" %}

        {% set eyebrowText = ( eyebrow ?? '' )|striptags|trim|lower|ascii|kebab  %}
        {% if eyebrowText %}
            {% set eyebrow = eyebrow|retconAttr( 'div', { id: eyebrowText }) %}
        {% endif %}

        {% if template %}
            {{ include( template, { headline: headline, eyebrow: eyebrow }, withContext = false) }}
        {% else %}
            {% if headline or eyebrow %}
                <div class="cHeadline {{- alignmentClass }}">
                    {{eyebrow}}
                    {{headline|raw}}
                </div>
            {% endif %}
        {% endif %}
    {% endif %}
{% endapply %}{%- endmacro %}


{% macro prose( text, size = 'lg', extraClass = '' ) -%}{% apply spaceless %}

    {% set text = text|trim %}

    {% if text %}
        {% set text = text|first == '<' ? text : "<p>#{text}</p>" %}

        {## <div class="prose {{proseClass}} {{alignmentClass}} {{extraClass}}"> ##}
        <div class="prose {{extraClass}}">
            {{- text
                | typogrify
                | retconChange( 'h1', 'h2' )
            -}}
        </div>
    {% endif %}
{% endapply %}{%- endmacro %}

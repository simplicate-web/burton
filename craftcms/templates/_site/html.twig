{% extends craft.app.request.isAjax() and not craft.app.request.getIsPreview()
    ? template_from_string('{% block html %}{% block page__ajax "" %}{% endblock %}')
    : "_core/html" %}

{## For `product` (Commerce) or `event` (Verbb Events) pages, populate the more common
    `entry` variable with the appropriate information. This helps to prevent errors
    like accessing `entry.title` vs `product.title` on a product page.
 ------------------------------------------------------------------------------------ ##}
{% set entry = entry ??? product ??? event ??? null %}

{% block html__class "no-js opacity-100 visible scroll-smooth" %}
{% block body__class "font-body text-theme m-0 p-0 min-h-screen h-full bg-gray-100" %}

{% block head__meta %}
    {% from '_core/html' import prefetch %}
    {{ prefetch([
        'https://unpkg.com',
        'https://cdn.polyfill.io',
        'https://cdn.jsdelivr.net',
        'https://fonts.googleapis.com',
        'https://fonts.gstatic.com',
    ]) }}

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
{% endblock %}

{% block head__fonts  include( '_site/html.fonts'  ) %}
{% block head__styles include( '_site/html.styles' ) %}

{% block head__scripts %}
    {% import '_core/javascript' as javascript %}

    {{ javascript.polyfillio() }}

    {## Vite Frontend Build
     -------------------------------------------------------------------------------- ##
        Responsible for handling the frontend build process and injecting appropriate
        <link> & <script> elemends into the page <head>.

        Vite builds these files by default:
            `frontend/css/app.pcss`
            `frontend/js/app,js`

        Manage Vite configuration via:
            `frontend/vite.config.js`
     -------------------------------------------------------------------------------- ##}
    {{ javascript.vite() }}

    {## These could/should be moved into the vite build process to improve site
        performance -- if the components that use them will be kept. ##}
    {{ javascript.htmx_cdn() }}
    {{ javascript.alpine_cdn() }}

    {## Vanilla helper & utility functions ##}
    {{ javascript.waitForGlobal() }}
    {{ javascript.cookie() }}
    {{ javascript.htmxInit() }}
    {{ javascript.enabledCheck() }}
    {{ javascript.globalVars() }}
    {{ javascript.tabHandler() }}
{% endblock %}


{% block html %}
{##
    {% set _eager = {
        common:
            ["images", "topics"],

        header:
            ["headerBuilder"] |
            merge([
                "image:images","media:assets","fragment:reusable","action:collections",
                "collection:items","collection:entries","collection:assets","collection:collections",
            ] | map( p => "headerBuilder.#{p}") ),

        content:
            ["bodyBuilder"] |
            merge([
                "image:images","media:assets","fragment:reusable","action:collections",
                "collection:items","collection:entries","collection:assets","collection:collections",
            ] | map( p => "bodyBuilder.#{p}") ),

        sidebar:
            ["sidebarBuilder"] |
            merge([
                "image:images","media:assets","fragment:reusable","action:collections",
                "collection:items","collection:entries","collection:assets","collection:collections",
            ] | map( p => "sidebarBuilder.#{p}") ),
    } %}

    {% if entry and entry.id|default() and className(entry) %}
        {% do craft.app.elements.eagerLoadElements(
            className(entry),
            [entry],
            [''] | merge(_eager.common  ??? '')
                 | merge(_eager.header  ??? '')
                 | merge(_eager.content ??? '')
                 | merge(_eager.sidebar ??? '')
        ) %}
    {% endif %}
##}


    {## supes dupes important. don't remove. ##}
    {## https://stackoverflow.com/a/32642249 ##}
    {{ parent() }}
{% endblock %}
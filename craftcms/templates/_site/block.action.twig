{## Action Block Site Base
{-------------------------------------------------------------------------------------##
    -> http://localhost:8000/sitehub/blocks/action
{-------------------------------------------------------------------------------------##}
{% extends [ "_core/block.action" ] %}


{% block content %}
    {% set settings = settings ??? block.settings ??? {}  %}
    {% set variant  = settings.variant ??? 'assemble' %}
    {{ variant == 'search' ? block('block__search') : block( 'block__assemble' ) }}
{% endblock content %}


{% block action__component %}
    {% set vue = block.component.settings.vueComponent ??? null %}
    {% if vue %}
        {{ _self.vuecomponent( vue, block, settings ) }}
    {% endif %}

    {% import "_assemble" as assemble %}
    {% if block.component.value == 'accountlogin' %}
        {{ assemble.accountparts( block, 'login', settings ) }}
    {% endif %}

    {% if block.component.value == 'accountforgot' %}
        {{ assemble.accountparts( block, 'forgot', settings ) }}
    {% endif %}
{% endblock %}


{% block block__search %}
    {% set settings    = settings ??? block.settings ??? {}  %}
    {% set collections = block.collections.ids() ??? block.collections ??? null %}

    {{ sprig( "_site/collection.search.sprig", {
        settings   : settings,
        collections: collections,
        zone1      : block('block__text'),
        header     : block('block__header'),
        footer     : block('block__footer')
    }) }}
    {% css %}.sprig-component { width: 100%; }{% endcss %}
{% endblock %}


{% macro vuecomponent( component, block, settings ) %}

    {## Create a simple object that can be JSON encoded and passed to the Vue Component ##}
    {% set simpleobj = {
        id: block.id ??? null,
        settings: settings ?? null,
        owner: {
            id   : block.owner.id       ??? null,
            title: block.owner.title    ??? null,
            dek  : block.owner.dek      ??? block.owner.summary ???  null,
            text : block.owner.text     ??? null,
            slug : block.owner.slug     ??? null,
            url  : block.owner.url      ??? null ,
            date : block.owner.postDate ??? null ,
            image: block.owner.images.asArray ??? [],
        }
    } %}

    {% set uuid = md5( settings | json_encode ) %}
    <div id="vue_{{uuid}}" class="w-full"></div>
    {% js %}
        window.waitForGlobal("app.createApp", function() {
            app.createApp(
                app.{{ component }},
                { block: {{ simpleobj | json_encode() | raw }} }
            ).mount( '#vue_{{uuid}}' )
        })
    {% endjs %}
{% endmacro %}
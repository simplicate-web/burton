{## Block Skeleton
 ------------------------------------------------------------------------------------ ##}
{% extends [template_from_string("{% block block %}{% endblock %}")] %}
{% import "_core/assemble" as assemble %}
{% import "_core/block"    as blocks %}

{## Yes, this is a valid name. Silly, right? ##}
{% block block %}

    {## Spacer between blocks (Before) ##}
    {% block before assemble.spacer( block.settings.betweenBefore ??? false ) %}

    {## Theme block + open theme tag ##}
    {% block theme %}
    {% block theme__open blocks.openTheme( block.settings, true ) %}

        {## Section block + content ##}
        {% block section %}
            {% block open blocks.openBlock( block.settings ) %}
            {% block content "" %}
            {% block close blocks.closeBlock( block.settings ) %}
        {% endblock %}

    {## Close theme tag + block  ##}
    {% block theme__close blocks.closeTheme( block.settings, true ) %}
    {% endblock theme %}

    {## Spacing between blocks (After) ##}
    {% block after assemble.spacer( block.settings.betweenAfter ??? false ) %}

{% endblock %}



{## Zone 1 Text Content - Commonly CKEditor or Redactor based Rich Text/HTML
 ------------------------------------------------------------------------------------ ##
    Most Block types share a common "Zone 1 Text" field, but it is frequently optional.

    This block is responsible for rendering the Zone 1 / Text field content and making
    any necessary adjustments to the content based on the block attribute settings.
 ------------------------------------------------------------------------------------ ##}
{% block block__text -%}

    {% set processedText1 = processedText1 ??? richHtml( block.text ??? null ) %}

    {% if processedText1 ??? null %}

        {## Move the block headline to <header> when left/right cols stack on mobile
         ----------------------------------------------------------------------------- ##}
        {% if block.headline ??? processedText1.eyebrow ??? processedText1.headline %}
            {% if not block.settings.leadingTextHeadlinesToMicroHeader|default(false) %}
                {% set class = collect(['LEFT','RIGHT']) | filter( v => v in block.settings.microLayout|default()|upper )
                    ? "!hidden lg:!block"
                    : null %}

                    {% set header %}
                        {{ processedText1.eyebrow | raw }}
                        {% if block.headline ??? null %}
                            <h1>{{ block.headline }}</h1>
                        {% endif %}
                        {{ processedText1.headline | raw }}
                    {% endset %}

                    {{ header | retconAttr( '*', { class: class }, false ) }}
            {% endif %}
        {% endif %}

        {{ processedText1.body | raw }}

        {## If the block has a CTA, display it here unless it's been moved to the footer ##}
        {% if not block.settings.textCtaToMicroFooter|default(false) %}
            {{ processedText1.cta | raw }}
        {% endif %}

    {% endif %}

{%- endblock %}



{## Block <header> zone content
 ------------------------------------------------------------------------------------ ##}
{% block block__header %}

    {## Duplicates the block headline into the block <header> for better mobile display.
     -------------------------------------------------------------------------------- ##}
    {% set processedText1 = processedText1 ??? richHtml( block.text ??? null ) %}

    {% if block.headline ??? processedText1.eyebrow ??? processedText1.headline %}

        {% set header %}
            {{ processedText1.eyebrow | raw }}
            {% if block.headline ??? null %}
                <h1>{{ block.headline }}</h1>
            {% endif %}
            {{ processedText1.headline | raw }}
        {% endset %}

        {% if block.settings.leadingTextHeadlinesToMicroHeader|default(false) %}
            {{ header }}
        {% else %}
            {% if collect(['LEFT','RIGHT']) | filter( v => v in block.settings.microLayout|upper ) %}
                {% set class = "lg:!hidden" %}
                {{ header | retconAttr( '*', { class: class }, false ) }}
            {% endif %}
        {% endif %}

    {% endif %}

{% endblock %}



{## Block <footer> zone content
 ------------------------------------------------------------------------------------ ##}
{% block block__footer %}

    {% set processedText1 = processedText1 ??? richHtml( block.text ??? null ) %}

    {## Moves Text CTA to block footer
     -------------------------------------------------------------------------------- ##}
    {% if block.settings.textCtaToMicroFooter|default(false) and processedText1.cta ??? null %}
        {{ processedText1.cta | raw }}
    {% endif %}

{% endblock %}
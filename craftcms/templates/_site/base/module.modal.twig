{## Modal Base Template
 ------------------------------------------------------------------------------------ ##

 ------------------------------------------------------------------------------------ ##}
{% extends template_from_string("{% block modal %}{% endblock %}") %}

{% block modal %}
    {% set content     = content     ??? null %}
    {% set headline    = headline    ??? null %}
    {% set outerClass  = outerClass  ??? null %}
    {% set panelClass  = panelClass  ??? null %}
    {% set modalClass  = modalClass  ??? null %}
    {% set overlay     = overlay     ??? null %}
    {% set buttonClass = buttonClass ??? null %}
    {% set open        = open        ??? false %}
    {% set theme       = theme       ??? 'bright' %}
    {% set triggerText = triggerText  ?? 'See More' %}
    {% set xTrapConfig = xTrapConfig ??? 'open' %}
    {% set uuid        = create('craft\\helpers\\StringHelper').UUID() %}

    <div x-data="{}" class="self-baseline">
        {% block trigger %}
            <button type="button" class="{{ block( 'buttonClass' ) }}" x-on:click="$dispatch( 'openmodal', { uuid: '{{uuid}}' } )">
                {% block triggerText %}{{ triggerText }}{% endblock %}
            </button>
        {% endblock %}

        <template x-teleport="body">
            <div
                x-data="{
                    open: {{ open ? 'true' : 'false' }},
                    id: '{{uuid}}'
                }"

                x-init="$watch('open', function(value) {
                    if( value ) { $dispatch( 'closemodals', { except: '{{uuid}}' } ) }
                } )"

                {{'@'}}openmodal.window="if( id == event.detail.uuid ){ open = true }"

                {{'@'}}closemodals.window="if( id != event.detail.except ){ open = false }"

                x-show="open"
                style="display: none"
                x-on:keydown.escape.prevent.stop="open = false"
                role="dialog"
                aria-modal="true"
                x-id="['modal-title']"
                :aria-labelledby="$id('modal-title')"
                class="{{ block( 'outerClass' ) }}"
            >
                {% block overlay %}
                    <div x-show="open" x-transition.opacity class="fixed inset-0 bg-black/70"></div>
                {% endblock %}

                <div
                    x-show="open" x-transition
                    x-on:click="open = false"
                    class="{{ block( 'panelClass' ) }}"
                    x-trap.noscroll.inert = "{{xTrapConfig}}"
                    x-data="{
                        width: 0,
                        setWidth() { this.width = window.innerWidth > 0 ? window.innerWidth : screen.width }
                    }"
                    {{'@'}}resize.window.debounce="setWidth()"
                    x-init="setWidth()"
                >
                    <template x-if="open">
                        <div
                            x-on:click.stop
                            class="{{ block( 'modalClass' ) }}"
                        >
                            {## headline ##}
                            {% block headline %}
                                {% if headline ??? null %}
                                    <h2 class="html pr-10" :id="$id('modal-title')">{{ headline }}</h2>
                                {% endif %}
                            {% endblock %}

                            {## content ##}
                            {% block content %}{{ content }}{% endblock %}

                            {## buttons ##}
                            {% block closeButton %}
                                <div class="absolute right-0.5 top-0.5 z-30">
                                    <button type="button" x-on:click="open = false">
                                        {{ include( 'vectors/dismiss.svg' ) }}
                                    </button>
                                </div>
                            {% endblock %}
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </div>
{% endblock %}

{% block modalClass %}
    relative
    w-full
    max-w-4xl
    overflow-y-auto
    rounded-xl
    bg-theme-contrast-light
    p-8
    shadow-lg
{% endblock %}

{% block outerClass %}
    fixed
    inset-0
    z-100
    overflow-y-auto
{% endblock %}

{% block buttonClass %}
    button
    clickCover
{% endblock %}

{% block panelClass %}
    relative
    flex
    min-h-screen
    items-center
    justify-center
    p-4
{% endblock %}


{##
    how to use this modal.

    <button hx-get="/modal" hx-target="modalContent">Open a Modal</button>
##}
{% macro dynamic() %}

    <div
        role="dialog"
        aria-modal="true"

        x-data="{
            open:false,
            onAfterSwap() {
                this.open = true
            },
            doClose() {
                this.open = false
            }
        }"

        x-cloak
        x-show="open"
        x-on:keydown.escape.window="doClose()"
        x-on:htmx:after-swap="onAfterSwap()"

        class="flex justify-center items-center overflow-hidden"
        :class="{
            'fixed top-0 right-0 bottom-0 left-0 z-50 bg-black/70': open
        }"
    >
        <div class="absolute top-0 right-0 bottom-0 left-0" x-on:click="doClose()"></div>

        <div
            x-trap.noscroll.inert="open"
            class="relative w-full max-w-3xl rounded-xl max-h-[90vh] overflow-hidden bg-theme-contrast-light shadow-lg z-50"
        >
            <div class="p-2 absolute top-0 left-0 right-0 z-50 flex justify-end">
                <a href="#" x-on:click.prevent="doClose()" class="flex gap-2 items-center text-theme hover:text-theme-alert"><span>Close</span><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 fill-current" viewBox="0 0 24 24"><path d="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z" /></svg></a>
            </div>
            <div id="modalContent" class="overflow-y-auto max-h-[90vh] pt-8"></div>
        </div>
    </div>
{% endmacro %}

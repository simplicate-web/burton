{% macro summaryMaxH4( summary = "" ) %}
    {{ summary
        | retconRemove( [ 'img', 'figure', 'iframe' ] )
        | retconChange( [ 'h1', 'h2', 'h3' ], 'h4' )
    }}
{% endmacro %}


{% macro summaryRetainEmphasis( summary = "" ) %}
    {{ summary
        | retconRemove( [ 'img', 'figure', 'iframe' ] )
        | retconChange( [ 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'ol', 'ul', 'li', 'blockquote', 'div', 'a' ], '' )
    }}
{% endmacro %}


{% macro headline( headline = null, tag = null, class = null ) %}
    {% set tag = tag | lower %}

    {% switch tag %}
        {% case 'h1' %} {{ _self.headlineH1( headline, class ) }}
        {% case 'h2' %} {{ _self.headlineH2( headline, class ) }}
        {% case 'h3' %} {{ _self.headlineH3( headline, class ) }}
        {% case 'h4' %} {{ _self.headlineH4( headline, class ) }}
        {% default   %} {{ _self.headlineH3( headline, class ) }}
    {% endswitch %}
{% endmacro %}



{% macro headlineH1( headline = null, class = null, eyebrow = null ) %}
    {% if headline ??? null %}
        {{ eyebrow ??? null }}
        <h1 class="{{ class ??? null }}" data-headline="true">
            {{ headline
                | retconChange( ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'], '' )
            }}
        </h1>
    {% endif %}
{% endmacro %}


{% macro headlineH2( headline = null, class = null, eyebrow = null ) %}
    {% if headline ??? null %}
        {{ eyebrow ??? null }}
        <h2 class="{{ class ??? null }}" data-headline="true">
            {{ headline
                | retconChange( ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'], '' )
            }}
        </h2>
    {% endif %}
{% endmacro %}


{% macro headlineH3( headline = null, class = null, eyebrow = null ) %}
    {% if headline ??? null %}
        {{ eyebrow ??? null }}
        <h3 class="{{ class ??? null }}" data-headline="true">
            {{ headline
                | retconChange( ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'], '' )
            }}
        </h3>
    {% endif %}
{% endmacro %}


{% macro headlineH4( headline = null, class = null, eyebrow = null ) %}
    {% if headline ??? null %}
        {{ eyebrow ??? null }}
        <h4 class="{{ class ??? null }}" data-headline="true">
            {{ headline
                | retconChange( ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'], '' )
            }}
        </h4>
    {% endif %}
{% endmacro %}


{% macro body( text = null, settings = {} ) %}

    {% set richtext = richHtml( text ) %}

    {% if richtext %}

        {## Move the block headline to <header> when left/right cols stack on mobile
         ----------------------------------------------------------------------------- ##}
        {% if richtext.eyebrow ??? richtext.headline %}

            {% if not settings.leadingTextHeadlinesToMicroHeader|default(false) %}
                {% set class = collect(['LEFT','RIGHT']) | filter( v => v in settings.microLayout|default()|upper )
                    ? "!hidden lg:!block"
                    : null %}

                    {# {% set header = ( richtext.eyebrow ~ richtext.headline )
                        | raw
                        | retconAttr( '*', { class: class }, false )  %} #}

                    {% set header = ( richtext.eyebrow ~ richtext.headline )
                        | retconAttr( '*', { class: class }, false )  %}

                    {# {{ header | retconAttr( '*', { class: class }, false ) }} #}
            {% endif %}

        {% endif %}

        {{ richtext.eyebrow  | raw }}
        {{ richtext.headline | raw }}

        {{ richtext.body | raw }}

        {{ richtext.cta  | raw }}

        {## If the block has a CTA, display it here unless it's been moved to the footer ##}
        {% if not settings.textCtaToMicroFooter|default(false) %}
            {{ richtext.cta | raw }}
        {% endif %}

    {% endif %}
{% endmacro %}


{## If the block has a CTA, display it here unless it's been moved to the footer ##}
{% macro blockFooter( text = null, settings = {} ) %}
    {% set richtext = richHtml( block.text ??? null ) %}

    {# {% if richtext ??? null %}
        {% if block.settings.textCtaToMicroFooter|default(false) %}
            {{ richtext.cta | raw }}
        {% endif %}
    {% endif %} #}
{% endmacro %}


{% macro blockHeader( text = null, settings = {} ) %}

    {## Duplicates the block headline into the block <header> for better mobile display.
     -------------------------------------------------------------------------------- ##}
    {% set richtext = richHtml( block.text ??? null ) %}

    {# {% if block.headline ??? richtext.eyebrow ??? richtext.headline ??? null %}
        {% set header %}
            {{ richtext.eyebrow | raw }}
            {% if block.headline ??? null %}
                <h1>{{ block.headline }}</h1>
            {% endif %}
            {{ richtext.headline | raw }}
        {% endset %}

        {% if block.settings.leadingTextHeadlinesToMicroHeader|default(false) %}
            {{ header }}
        {% else %}
            {% if collect(['LEFT','RIGHT']) | filter( v => v in ( block.settings.microLayout ??? block.settings.layout ) | upper ) %}
                {% set class = "lg:!hidden" %}
                {{ header | retconAttr( '*', { class: class }, false ) }}
            {% endif %}
        {% endif %}
    {% endif %} #}
{% endmacro %}
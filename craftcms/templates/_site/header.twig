{## Page Header Elements   [Site Template]
{---------------------------------------------------------------------------------------}
    Defaults & common elements that appear in and around the site-wide page <header>.
    - http://localhost:8000/sitehub/layout/header
{-------------------------------------------------------------------------------------##}
{% extends template_from_string('{% block base "" %}') %}



{% block base %}
    {%- set block1   = entry.headerBuilder.one() ??? null -%}
    {%- set subtitle = entry.fullTitle ??? null | retconRemove('h1') -%}
    {%- set theme    = ( subtitle and not block1 ) ? 'light' : 'base' -%}
    {%- set owner    = entry ??? block1.owner ??? null -%}

    {%- set settings = settings ?? null is iterable ? settings : {} -%}
    {%- set settings = {
        theme      : theme,
        builder    : 'header',
        container  : 'fluid',
        spacerabove: 'medium',
        spacerbelow: 'medium',
        section    : owner.section.handle ??? owner.section ??? null,
        entrytype  : owner.type.handle    ??? owner.type    ??? null,
        entryid    : owner.id  ?? null,
        entryurl   : owner.url ?? null,
        blockpath  : [
            "_site/header.block.%blocktype%.%variant%",
            "_site/header.block.%blocktype%",
            "_site/block.%blocktype%.%variant%",
            "_core/block.%blocktype%.%variant%",
            "_site/block.%blocktype%",
            "_core/block.%blocktype%",
            "_site/header.block",
            "_site/block",
            "_core/block"
        ],
    } | merge( settings ) -%}

    {% set blocks = [block1 ??? { html: block( 'plaintitle') }] %}
    {{ block('builder') }}
{% endblock %}


{% block builder %}
    {% import "_core" as assemble %}
    {%- for block in BuilderBase( blocks ??? [], settings ??? {} ) -%}
        {{ loop.first ? raw( block('masthead__open') ??? null )  : null }}
        {{ assemble.blockpart( 'block__includepath', block, block.settings | merge({ loop: loop }) ) }}
        {{ loop.last  ? raw( block('masthead__close') ??? null ) : null }}
    {%- endfor -%}
{% endblock %}


{% block masthead__open %}
    {% set headerabove = block.settings.headerabove ??? 'brandfull' %}
    {% set theme = block.settings.theme ??? 'base' %}

    {% if headerabove in ['brandfull','brandonly'] %}
        {{ block('topbar') }}
        {{ block('opentag') }}

        {% if headerabove == 'brandfull' %}
            {{ block('breadcrumb') }}
        {% endif %}
    {% endif %}

    {% if headerabove == 'minimal' %}
        {{ block('topbar__minimal') }}
        {{ block('opentag') }}
    {% endif %}
{% endblock %}


{% block masthead__close %}
    {%- set headerabove = block.settings.headerabove ??? null   -%}
    {%- set headerbelow = block.settings.headerbelow ??? 'auto' -%}

    {{ block('closetag') }}

    {%- if headerbelow == 'auto' and headerabove == 'brandonly' -%}
        {{ block('breadcrumb') }}
    {%- endif -%}
{% endblock %}


{% block plaintitle %}
    {%- set header__title    = header__title ??? entry.fullTitle | retconOnly('h1') | retconChange( 'h1', false ) ??? null -%}
    {%- set header__align    = header__align ??? 'center' -%}
    {%- set header__title    = header__title ??? entry.title -%}
    {%- set header__subtitle = header__subtitle ??? entry.fullTitle | retconRemove('h1') ??? null -%}

    {% if header__title or header__subtitle %}
        <div class="max-w-5xl {{ header__align == 'center' ? 'mx-auto' : '' }}">
            <div class="@container flex flex-col gap-3 last-child-mb-0" data-headercopy>
                {{ header__title    ? tag( 'h1',  { html: header__title|widont, class:['text-theme-accent', "#{header__align == 'center' ? 'text-center'}"], itemprop: 'headline' } ) }}

                {% if header__subtitle %}
                    {{ header__subtitle ? tag( 'div', {
                        html: header__subtitle | widont | retconAttr( 'p', { class: 'larger' } ),
                        class: ['last-child-mb-0 -mt-10', "#{header__align == 'center' ? 'mx-auto text-center'}"],
                        itemprop:'description'
                    }) }}
                {% endif %}
            </div>
        </div>
    {% endif %}
{% endblock %}


{% block logo tag( 'div', {
    class: "flex items-center w-full gap-8 text-white",
    html : block('logosvg')
} ) %}


{% block logosvg %}
    <a
        x-data
        x-cloak
        href="{{ siteUrl('/') }}"
        class="text-theme-bodycopy leading-none flex items-center hover:text-theme-accent-tint py-2"
    ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" class="block h-28 fill-current">
        <path d="m51.8 20.7 17.9 52.6H36.9c1.4-3.9 6.5-12.6 24-16l-4-12-15.7 6.3 10.6-31Zm21.6 21v-35H61.9l11.5 35ZM6.6 6.6v66.7h13.1L42.5 6.5H6.6Z" />
    </svg></a>
{% endblock %}


{% block breadcrumb %}
    {%- import "_core" as assemble -%}
    {%- set breadcrumbs = assemble.container( 'fluid', assemble.menu( 'breadcrumb', entry ??? null, {} ) ) -%}
    {{- breadcrumbs | attr({ class: "relative z-10 opacity-50 hover:opacity-100 focus-within:opacity-100" }) -}}
{% endblock %}


{% block topbar %}
    {%- import "_core" as assemble -%}
    {{ tag( 'div', {
        class: 'w-full relative z-50 canvas',
        data : { theme: 'accent' },
        html : assemble.container( 'fluid', tag( 'div', {
            class: "flex",
            html : block('logo') ~ block('navigation')
        }) )
    }) }}
{% endblock %}


{% block topbar__minimal %}
    {%- import "_core" as assemble -%}
    {{ tag( 'div', {
        class: 'w-full relative z-50 canvas',
        data : { theme: 'accent' },
        html : assemble.container( 'fluid', tag( 'div', {
            class: "flex",
            html : block('logo') ~ block('navigation__minimal')
        }) )
    }) }}
{% endblock %}


{% block navigation %}
    {{ tag( 'div', {
        class: "w-full flex flex-col flex-grow text-right justify-between items-end gap-6 py-2 @container",
        html : block('utility') ~ block('primary') ~ block('mobile')
    } ) }}
{% endblock %}


{% block navigation__minimal %}
    {{ tag( 'div', {
        class: "w-full flex flex-col flex-grow text-right justify-between items-end gap-6 py-2 @container",
        html : block('utility') ~ block('mobile')
    } ) }}
{% endblock %}


{% block primary %}
    {% import "_core" as assemble %}
    {{ tag( 'div', {
        class: "hidden md:flex items-center gap-6",
        html : assemble.menu( 'primary', entry ??? null, {} )
    } ) }}
{% endblock %}


{% block utility %}
    {% set handle = 'utility' %}
    {% set title  = title ??? craft.navigation.getNavByHandle( handle ).name ??? 'Utility' %}
    {% set nodes  = craft.navigation.nodes().handle( handle ).level(1) %}

    {% if nodes | length %}
        <div class="hidden md:flex items-center gap-3 text-xs">
            {% embed ["_site/menu.list", "_core/menu.list"] with {
                title : title,
                handle: handle,
                items : nodes.all() ??? null,
            } %}
                {% block lastItem %}
                    {{ block( 'openItem' ) }}

                    {{ tag( 'a', {
                        href : siteUrl('/search'),
                        class: 'block w-4 h-4 -mt-0.5',
                        html : svg( '@appicons/search.svg' ) | attr({ 'class': 'w-4 h-4 block fill-current'})
                    }) }}

                    {{ block( 'closeItem' ) }}
                {% endblock %}

                {% block menuClass %}
                    m-0
                    p-0
                    list-none
                    flex
                    items-center
                    gap-3
                    text-sm
                    no-underline
                {% endblock %}

                {% block itemClass %}
                    flex
                    flex-col
                    items-center
                    p-2
                    text-theme-link
                    underline-offset-1
                    hover:underline
                    hover:text-theme-link-tint
                {% endblock %}
            {% endembed %}
        </div>
    {% endif %}
{% endblock %}


{## Not the mobile menu, just an alpine trigger for it ##}
{% block mobile %}
    {% import "_core/menu.mobile" as mobilemenu %}
    {{ mobilemenu.trigger() }}
{% endblock %}


{% block opentag %}
    <header {{ attr({
        id   : "masthead",
        role : "banner",
        class: "relative z-10 canvas",
        data : { theme: theme ??? 'base' }
    }) }}>
{% endblock %}


{% block closetag "</header>" %}
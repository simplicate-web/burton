{% import "_macros/imgtags" as imgtags %}
{% set settings = settings ??? null %}

{% set source   = settings.image.url  ??? settings.image ??? null %}
{% set kind     = settings.image.kind ??? source|split('.')|last|lower ??? 'image' %}

{% block figure %}
    <figure class="m-0 p-0 flex flex-col">
{% endblock %}

{# -- lottie animations -- #}
{% if kind in ['json','lottie'] %}
    {% block lottieTag %}
        {{ tag('lottie-player', {
            src       : source,
            class     : settings.imageClass,
            autoplay  : true,
            loop      : true,
            ariaHidden: true,
            role      : "presentation",
            mode      : "bounce",
            loading   : 'lazy'
        }) }}
    {% endblock %}
{% endif %}

{# -- regular images -- #}
{% if kind in ['image','jpg','jpeg','png','gif','webm'] %}
    {% block imageTag %}
        <picture>
            {# -- code for responsive sizes / webm conversion goes here -- #}

            {# -- output the image tag -- #}
            {{ imgtags.imgTag(
                settings.image,
                settings.imageTransform,
                settings.altText ??? null,
                settings.imageClass
            ) }}
        </picture>
    {% endblock %}
{% endif %}


{# if a `caption` exists, use it for the <figcaption>,
   if not, use `altText` but only show it to screen readers #}
{% block figcaption %}
    {% set caption = settings.imageCaption ??? null %}
    {% set altText = settings.altText      ??? null %}
    {% set captionText = caption ? attribute(settings.image, caption) ??? caption : null %}
    {{ captionText ? imgtags.figCaption( captionText ) }}
    {{ not captionText and altText ? imgtags.figCaption( altText, "sr-only" ) }}
{% endblock %}

</figure>

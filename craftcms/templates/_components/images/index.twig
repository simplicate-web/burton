{% macro frame( image = null, frame = null, settings = null ) %}{% if image %}

    {## allow `frame` to be passed as an array ##}
    {% set frame = frame is iterable ? frame : [frame] %}
    {% set frame = frame | merge(['auto']) | filter %}
    {% set frame = frame | map( name => "_components/images/frame.#{name}" ) %}

    {## embed the image into the frame ##}
    {% embed frame with {
        image: image,
        settings: settings,
    } %}{% endembed %}

{% endif %}{% endmacro %}


{% macro generate( image, settings ) %}

    {## passed an image object ##}
    {% if image.url ??? null %}

        {% if ( settings.transform ??? null ) and ( image.url ??? null ) %}
            {% do image.setTransform( settings.transform ) %}
        {% endif %}

        {{ tag( 'figure', {
            class:  settings.figure ??? null,
            html: tag( 'img', {
                src    : image.url,
                width  : image.width    ??? null,
                height : image.height   ??? null,
                class  : settings.image ??? null,
                loading: 'lazy'
            })
        }) }}

    {## passed html string containing <img> tag ##}
    {% else %}

        {% if image and image is iterable and className( image ) ??? null %}
            {% from "_components/images" import placeholder %}
            {{ settings._placeholder ??? null == 'icon'
                ? placeholder( 170, 170, 'icon' )
                : placeholder()  }}

        {% else %}
            {{ tag( 'figure', {
                class:  settings.figure ??? null,
                html: image | retconAttr( 'img', { class: settings.image ??? null, loading: 'lazy' }, false )
            }) }}
        {% endif %}

    {% endif %}
{% endmacro %}




{% macro caption() %}
    {# {% if caption == 'summary' and getenv('CRAFT_ENVIRONMENT') != 'production' %}
        {% set caption = random([
            'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer auctor, lectus sed hendrerit porta, urna nisl vehicula enim.',
            'Vivamus sit amet nibh et nisi consequat vestibulum. Proin varius nunc ut sapien aliquam, et vestibulum enim pellentesque.',
            'Duis fringilla mauris vel mi bibendum cursus. Integer vel tellus vel leo efficitur commodo.',
            'Donec sed elit at ligula scelerisque laoreet. Praesent ut orci euismod, hendrerit nibh ac, aliquam quam.',
            'Mauris viverra placerat congue. Fusce ut dapibus eros, et imperdiet neque. Sed quis risus et dolor bibendum pellentesque.'
        ]) %}
    {% endif %}

    {% set class = class ??? "text-sm text-center py-2" %}

    {{ caption ? tag( 'figcaption', { html: caption, class: class } ) }} #}
{% endmacro %}




{## automatic placeholder images during development ##}
{% macro placeholder( transformNameOrWidth, height, type = null ) %}
    {% if getenv('CRAFT_ENVIRONMENT') != 'production' %}

        {% set width = 800 %}
        {% if height ??? null %}
            {% set width = transformNameOrWidth %}
        {% else %}
            {% set height = 800 %}
        {% endif %}

        {% if transformNameOrWidth ??? null != width %}
            {% set transform = craft.app.getImageTransforms().getTransformByHandle( transformNameOrWidth|default('square') ) %}
            {% set width  = transform.width|default(width)   %}
            {% set height = transform.height|default(height) %}
        {% endif %}

        {{ _self.generate( tag( 'img', {
            src: type == 'icon'
                ? "https://placeskull.com/#{width}/#{height}/475569/#{random(1,24)}"
                : "https://picsum.photos/seed/#{random(1,9999)}/#{width}/#{height}?grayscale&blur=2",
            alt: 'Placeholder'
        }) ) }}
    {% endif %}
{% endmacro %}
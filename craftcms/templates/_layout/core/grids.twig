{## Grid Layout Generator
 ------------------------------------------------------------------------------------ ##

    Mobile ready named layouts for slapping a grid-based wrapper div (or whatever)
    around one (or many) elements. Used extensively within Collection & Media blocks.

    - http://localhost:8000/sitebook/layout/grids
    - http://localhost:8000/sitebook/blocks/collection
    - http://localhost:8000/sitebook/blocks/media

 ------------------------------------------------------------------------------------ ##

 !! This macro outputs as JSON so that it can be read by the macro template or any
    other place it might be useful (like Sitebook reference pages).

 ------------------------------------------------------------------------------------ ##}
{% macro definitions() %}{{ {

    _:'## defaults are used for any attributes left off an option definition',
    defaults: {
        base: 'grid w-full',
        gap: 'gap-8 @3xl:gap-16 @7xl:gap-24'
    },

    _:'## named grid definitions',
    options: {

        fixed1: {
        _:'## Single column with row-gap.',
            cols: 'grid-cols-1'
        },

        fixed2: {
        _:'## Two columns wide at all widths.',
            cols: 'grid-cols-2',
            splideConfig: "{
                type: 'loop',
                breakpoints: {
                    9999: { perPage: 2, gap: '4rem' },
                    1280: { gap: '2rem' },
                    640:  { perPage: 1 }
                }
            }"
        },

        stacked2: {
        _:'## Two columns wide if *parent* is >672px',
            cols: 'grid-cols-1 @md:grid-cols-2',
            gap: 'gap-4 @xl:gap-8 @4xl:gap-12 @7xl:gap-16',
            splideConfig: "{
                type: 'loop',
                breakpoints: {
                    9999: { perPage: 2, gap: '4rem' },
                    1280: { gap: '2rem' },
                    640:  { perPage: 1 }
                }
            }"
        },

        stack2grow4: {
        _:'## Liked stacked2 but grows to four-wide above tablet width (768px).',
            cols: 'grid-cols-1 @md:grid-cols-2 @3xl:grid-cols-4',
            gap: 'gap-4 @md:gap-8 @3xl:gap-4 @4xl:gap-8 @5xl:gap-12',
            splideConfig: "{
                type: 'loop',
                breakpoints: {
                    9999: { perPage: 4, gap: '4rem' },
                    1280: { gap: '2rem' },
                    768 : { perPage: 2, gap: '1rem' },
                    640:  { perPage: 1 }
                }
            }"
        },

        fixed3: {
        _:'## Three columns wide at all widths.',
            cols: 'grid-cols-3',
            gap: 'gap-4 @3xl:gap-8 @5xl:gap-12 @7xl:gap-16',
            splideConfig: "{
                type: 'loop',
                breakpoints: {
                    9999: { perPage: 3, gap: '4rem' },
                    1280: { gap: '2rem' },
                    1024: { perPage: 2, gap: '1rem' },
                    640:  { perPage: 1 }
                }
            }"
        },

        stacked3: {
        _:'## Three columns wide if *parent* >896px. Two-wide between 448-896px.',
            cols: 'grid-cols-1 @md:grid-cols-2 @4xl:grid-cols-3',
            gap: 'gap-8 @5xl:gap-12 @7xl:gap-16',
            splideConfig: "{
                type: 'loop',
                breakpoints: {
                    9999: { perPage: 3, gap: '4rem' },
                    1280: { gap: '2rem' },
                    1024: { perPage: 2, gap: '1rem' },
                    640:  { perPage: 1 }
                }
            }"
        },

        stacked6: {
        _:'## Six-wide if *parent* >1024px; Three-wide under 768px; Four-wide inbetween.',
            cols: 'grid-cols-3 @3xl:grid-cols-4 @5xl:grid-cols-6',
            gap: 'gap-4 @3xl:gap-8',
            splideConfig: "{
                type: 'loop',
                breakpoints: {
                    9999: { perPage: 6, gap: '4rem' },
                    768 : { perPage: 4, gap: '2rem' },
                    640:  { perPage: 2 }
                }
            }"
        }
    }
} | json_encode() | raw }}{% endmacro %}



{## Wrap a Grid layout around a string of html
 ------------------------------------------------------------------------------------ ##

 {% import "_layout/core/grids" as grids %}

 {{ grids.generate( htmlToWrap, 'gridName' ) }}

 ------------------------------------------------------------------------------------ ##}
{% macro generate( html, grid, modifier = null, extraClasses = null ) %}

    {% set json = _self.definitions() | json_decode %}
    {% set defs = json['defaults'] %}
    {% set opts = json['options'] %}

    {% set grid = ( opts[grid] ??? null ) ? grid : opts | keys | first %}
    {% set attr = opts[grid] ??? opts|first %}

    {{ tag( 'div', {
        html : html,
        data : { grid: grid },
        class: [
            attr["base__#{modifier}"] ??? defs["base__#{modifier}"] ??? attr.base ??? defs.base ??? null,
            attr["cols__#{modifier}"] ??? defs["cols__#{modifier}"] ??? attr.cols ??? defs.cols ??? null,
            attr["gap__#{modifier}"]  ??? defs["ga[__#{modifier}"]  ??? attr.gap  ??? defs.gap  ??? null,
            extraClasses
        ]
    }) }}
{% endmacro %}